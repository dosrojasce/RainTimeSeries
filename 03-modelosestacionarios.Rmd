# Modelos Estacionarios en Series de Tiempo

```{r include=FALSE}
library(forecast)
library(tseries)
library(ggplot2)
library(zoo)
library(knitr)

```
## Metodologia 
Esquematizar los modelos convencionales de series de tiempo a través de la metodología Box-Jenkins para encontrar patrones que nos permitan predecir futuras observaciones.

```{r}
# resumen serie log-transformada
summary(ts_lluvia_log)
```
La serie tiene valores mínimos en 0 indicando días sin precipitación y un máximo de 4.13 equivalente a una precipitación de aproximadamente 62 mm.

La mediana es de 0.41 e indica que la mayoría de los días tienen precipitaciones bajas, y la media es de 0.89, indicando algunos eventos extremos.

```{r}
# Gráfico de la serie temporal log-transformada
plot(ts_lluvia_log, main = "Serie Log-Transformada", col = "steelblue")
```


```{r}
#| warning: false
#| message: false
# prueba ADF para confirmar estacionariedad
adf_test1 <- adf.test(ts_lluvia_log)
adf_test1
```
la prueba de Dickey-Fuller aplicada a la serie diferenciada, muestra un estadístico negativo y un p-valor menor a 0.01 en todos los rezagos y tipos de prueba. Estos resultados permiten rechazar la hipótesis nula de no estacionariedad, lo que indica que la serie es estacionaria tras la transformación logarítmica.

```{r}
# grafico ACF
Acf(ts_lluvia_log, main = "ACF Serie Log-Transformada", col = "steelblue")
```

El gráfico de ACF muestra una autocorrelación significativa en los primeros rezagos, lo que indica una dependencia temporal a corto plazo y se observan picos de autocorrelación que exceden las bandas, indicando patrones estacionales en la serie.
La caída gradual de la autocorrelación a lo largo del tiempo indica una posible tendencia estacional de largo plazo. Ademas, los rezagos alrededor de 365 días muestran cierta correlación, lo que puede ser indicativo de un patrón anual en la precipitación.

```{r}
# Grafico Pacf
Pacf(ts_lluvia_log, main = "PACF Serie Log-Transformada", col = "steelblue")
```
La gráfica de la PACF presenta un pico alto en el primer rezago, lo que indica una autocorrelación significativa con el valor inmediato anterior de la serie.
A partir del segundo rezago, los valores caen rápidamente dentro de las bandas lo que indica una disminución de la autocorrelación para rezagos mayores.
Este comportamiento es consistente con un posible modelo autorregresivo de bajo orden, como un AR(1).
La falta prnunciados en rezagos más altos respalda la hipótesis de que no existe una correlación significativa de largo plazo en la serie.

```{r}
# modelo ARIMA
modelo1 <- auto.arima(ts_lluvia_log)
summary(modelo1)
```
El modelo ajustado es un ARIMA(2,0,1), que parece capturar de manera adecuada la estructura temporal de la serie log-transformada de precipitación diaria, los coeficientes para las componentes autorregresivas ar1 = 1.0953  y ar2 = -0.1984 y la componente de media móvil ma1 = -0.7475, son significativos y presentan errores estándar bajos.
Esto indica que las estimaciones son precisas y que el modelo es capaz de explicar bien la la serie temporal, el término de media distinta de cero - mean, indica que la serie transformada tiene un promedio positivo constante, lo que es coherente con los patrones de precipitación observados.
En cuanto a los criterios de información, se obtuvieron valores relativamente bajos:
 - AIC = 14018.26
 - BIC = 14051.21
Estos valores muestran un buen ajuste del modelo, ya que minimizan el balance entre la complejidad del modelo y su capacidad para explicar la variabilidad de los datos.

Por otro lado, las metricas de error para el conjunto de entrenamiento muestran un buen desempeño del modelo:
 - ME (Error Medio) cercano a cero (-0.00013), lo que indica un sesgo mínimo en las predicciones.
 - RMSE (Raíz del Error Cuadrático Medio) de 0.890, representando el error promedio en la escala logarítmica de la precipitación.
 - MAE (Error Absoluto Medio) de 0.713, indicando que el error típico es bajo en comparación con la variabilidad de la serie.
 - MASE (Error Absoluto Medio Escalado) de 0.713, indicando que el error del modelo es comparable al de un modelo simple basado en el promedio.

La baja autocorrelación del primer rezago de los residuos (ACF1 ≈ 0) evidencia que los residuos del modelo son independientes y se comportan como ruido blanco.

```{r}
# Diagnóstico de los residuos
checkresiduals(modelo1)
```

Test de Ljung-Box:

- p-valor = 0.2858: El p-valor es mayor a 0.05, lo que significa que no podemos rechazar la hipótesis nula de que los residuos son independientes.
Los residuos no presentan autocorrelación significativa, lo que valida que el modelo ajustado es adecuado.

Interpretación diagnistico del residuo:

los residuos del modelo ARIMA(2,0,1) indican que el ajuste es adecuado. El gráfico de residuos muestra un comportamiento aleatorio, sin patrones evidentes indicando que el modelo ha capturado la estructura temporal de la serie. La función de autocorrelación (ACF) confirma esta observación, ya que la mayoría de los residuos se encuentran dentro de las bandas, lo que indica la ausencia de autocorrelación significativa, además, el histograma muestra que los residuos tienen una distribución aproximadamente normal, aunque se observa una ligera asimetría hacia la derecha.

```{r}
# prueba de normalidad de los residuos
# no se puede aplicar la prueba shapiro debido a que los datos tienen mas de 5000 observaciones, por lo que se aplicará la prueba Jarque-Bera, que es más adecuada para muestras grandes.

jarque_bera_test <- jarque.bera.test(modelo1$residuals)
jarque_bera_test
```
Los resultados de la prueba de Jarque-Bera indican que los residuos del modelo ARIMA(2,0,1) no siguen una distribución normal, lo cual es respaldado por el p-valor bajo. Aunque la no normalidad es común en series temporales con eventos extremos o alta variabilidad, sin embargo , la independencia de los residuos (según el test de Ljung-Box) indica que el modelo sigue capturando adecuadamente la estructura temporal de la serie, aunque los residuos presentan desviaciones de la normalidad.
 
```{r}
# prueba de independencia de los residuos (Ljung-Box)
box_test <- Box.test(modelo1$residuals, type = "Ljung-Box")
box_test
```
La prueba de Ljung-Box confirma que los residuos del modelo ARIMA no presentan autocorrelación significativa, lo que indica que los residuos se comportan como ruido blanco.
 
```{r}
# pronostico para los próximos 12 meses
pronostico <- forecast(modelo1, h = 365)

# Graficar el pronóstico
plot(pronostico, main = "Pronóstico Próximos 12 Meses", ylab = "log(Precipitación)", xlab = "Año")

```

```{r}
# precisión del pronóstico
mae <- mean(abs(pronostico$residuals)) ; mae
rmse <- sqrt(mean(pronostico$residuals^2)) ; rmse
```
El modelo ARIMA proporciona un buen pronóstico, con errores relativamente bajos tanto en el MAE como en el RMSE, pero la diferencia entre estas dos métricas indica que podrían estar presentes algunos valores atípicos en los datos que afectan la precisión del modelo.

## Resultados y Análisis

El modelo ARIMA(2,0,1) aplicado a la serie log-transformada mostró un ajuste adecuado, logrando capturar las principales características de la serie temporal. Los coeficientes estimados para las componentes AR(2) y MA(1) fueron significativos y presentan errores estándar bajos, lo que indica que las estimaciones del modleo son precisas. Además, el término de media distinto de cero sugiere que la serie transformada tiene un promedio positivo constante, lo cual coincide con la observación de precipitaciones recurrentes a lo largo del tiempo.

Las métricas de error del conjunto de entrenamiento, con un MAE de 0.713 y un RMSE de 0.890, reflejan un desempeño satisfactorio del modelo. Sin embargo, la diferencia entre el MAE y el RMSE sugiere la presencia de eventos extremos en los datos, que influyen en la magnitud del error cuadrático medio. 

El diagnóstico de los residuos muestra un comportamiento aleatorio, sin patrones evidentes. La prueba de Ljung-Box arrojó un p-valor de 0.2858, lo que permite aceptar la hipótesis nula de que los residuos son independientes. Esto confirma que el modelo ha capturado la estructura temporal de la serie y que los residuos no presentan autocorrelación significativa. A pesar de que los residuos no siguen una distribución normal, según la prueba de Jarque-Bera, esto no afecta la validez del ajuste, ya que la independencia de los residuos es el principal criterio para validar el modelo ARIMA.

## Conclusiones
El modelo ARIMA(2,0,1) ajustado a la serie temporal log-transformada de precipitación muestra un desempeño sólido y es capaz de explicar adecuadamente la variabilidad observada en los datos. Las pruebas de diagnóstico indican que los residuos son independientes y se comportan como ruido blanco, lo que respalda la validez del modelo. Aunque los residuos presentan una ligera desviación de la normalidad, esto es atribuible a la naturaleza de la serie, que incluye eventos extremos de precipitación.

